# Тестовое задание: Простая реферальная система

Это реализация простого API для реферальной системы, выполненная в рамках тестового задания. Приложение построено на Django и Django REST Framework и запускается в Docker-контейнерах.

## Стек технологий

*   **Backend:** Python, Django, Django REST Framework
*   **База данных:** PostgreSQL
*   **Аутентификация:** JWT (djangorestframework-simplejwt)
*   **Контейнеризация:** Docker, Docker Compose

## Как запустить проект

Для запуска проекта на вашем локальном компьютере должны быть установлены Docker и Docker Compose.

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/nodecspro/referral_system
    cd referral-system
    ```

2.  **Запустите проект с помощью Docker Compose:**
    Эта команда соберет Docker-образы для веб-приложения и базы данных, создаст Docker-volumes для сохранения данных и запустит контейнеры.
    ```bash
    docker-compose up --build
    ```

3.  **Примените миграции базы данных:**
    Откройте **второй терминал** и выполните команду, чтобы создать таблицы в базе данных.
    ```bash
    docker-compose exec web python manage.py migrate
    ```

После выполнения этих шагов приложение будет доступно по адресу `http://localhost:8000`.

---

## Спецификация API (API Reference)

Все эндпоинты доступны по базовому URL: `/api/users/`

### 1. Запрос кода авторизации

*   **Endpoint:** `/request-code/`
*   **Метод:** `POST`
*   **Описание:** Начинает процесс аутентификации. Пользователь отправляет свой номер телефона, система генерирует 4-значный код и имитирует его отправку (выводит в консоль сервера).
*   **Тело запроса (Body):**
    ```json
    {
        "phone_number": "+79991234567"
    }
    ```
*   **Успешный ответ (200 OK):**
    ```json
    {
        "message": "Код авторизации отправлен."
    }
    ```

### 2. Подтверждение кода и получение токенов

*   **Endpoint:** `/verify-code/`
*   **Метод:** `POST`
*   **Описание:** Пользователь отправляет полученный 4-значный код. Если код верный, система авторизует пользователя (или создает нового, если это первый вход) и возвращает пару JWT-токенов (`access` и `refresh`).
*   **Тело запроса (Body):**
    ```json
    {
        "code": "1234"
    }
    ```
*   **Успешный ответ (200 OK):**
    ```json
    {
        "refresh": "eyJhbGciOiJIUzI1Ni...",
        "access": "eyJhbGciOiJIUzI1Ni..."
    }
    ```

### 3. Получение и обновление профиля пользователя

*   **Endpoint:** `/profile/`
*   **Авторизация:** Требуется (`Bearer Token`).
*   **Описание:** Эндпоинт для работы с профилем текущего авторизованного пользователя.

#### 3.1. Получение профиля

*   **Метод:** `GET`
*   **Успешный ответ (200 OK):**
    ```json
    {
        "id": 1,
        "phone_number": "+79991234567",
        "invite_code": "OmLRBD",
        "activated_invite_code": "XyZ123", // null, если код не был активирован
        "referred_users": [
            {
                "phone_number": "+79997654321"
            }
        ]
    }
    ```

#### 3.2. Активация чужого инвайт-кода

*   **Метод:** `PATCH`
*   **Описание:** Позволяет пользователю активировать чужой инвайт-код. Это можно сделать только один раз.
*   **Тело запроса (Body):**
    ```json
    {
        "invite_code": "XyZ123"
    }
    ```
*   **Успешный ответ (200 OK):** Возвращает обновленные данные профиля (см. `GET` /profile/).

---

## Тестирование

Для удобства тестирования в репозитории находится коллекция Postman:
`referral_system.postman_collection.json`.

Импортируйте ее в Postman для быстрого доступа ко всем эндпоинтам.